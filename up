#!/bin/sh

cd $(dirname $0)

#if hash php 2>/dev/null; then
#    php ./scripts/checkHosts.php
#    [ $? -ne 0 ] && exit
#else
#    echo "PHP not installed so hosts file not checked."
#    echo "You may want to manually check the ./config/local/hosts file and add these to your local hosts file."
#fi
echo "You will need to check the ./config/local/hosts file and add these to your local hosts file."

# Start Containers
echo "Containers are starting"
docker-compose up -d

# Install MediaWiki dbs
echo "MediaWiki is installing"

echo "Running composer install on mediawiki-apache-php5 container"
docker-compose exec "mediawiki-apache-php5" composer install --working-dir /var/www/mediawiki

echo "Running install.php script on mediawiki-apache-php7 container"
docker-compose exec "mediawiki-apache-php7" bash /var/www/mediawiki/.docker/installdbs

# Done
echo "Your development environment is running"